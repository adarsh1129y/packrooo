<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Envelope Reveal</title>
    <style>
        body {
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fff7e6 0%, #ffd6a5 50%, #ffb5a7 100%);
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            overflow: hidden;
            position: relative;
            animation: backgroundPulse 4s ease-out forwards;
        }

        @keyframes backgroundPulse {
            0% {
                background: linear-gradient(135deg, #fff7e6 0%, #ffd6a5 30%, #ffb5a7 70%);
            }

            50% {
                background: linear-gradient(135deg, #fff7e6 0%, #ffd6a5 50%, #ffb5a7 100%);
            }

            100% {
                background: linear-gradient(135deg, #fff7e6 0%, #ffd6a5 50%, #ffb5a7 100%);
            }
        }

        /* Video Background */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
            opacity: 0.8;
        }

        /* Video overlay for better text readability */
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 247, 230, 0.3) 0%, rgba(255, 214, 165, 0.4) 50%, rgba(255, 181, 167, 0.3) 100%);
            z-index: -1;
            pointer-events: none;
        }

        /* Optimized Magic Cursor Trail */
        .cursor-particle {
            position: fixed;
            width: 12px;
            height: 12px;
            background: radial-gradient(circle, #ff6b9d 0%, #ff8fab 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: magicParticleFade 1.5s ease-out forwards;
            box-shadow:
                0 0 20px rgba(255, 107, 157, 0.9),
                0 0 40px rgba(255, 107, 157, 0.6);
            will-change: transform, opacity;
        }

        .cursor-particle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #fff, transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: magicInnerGlow 1.5s ease-out forwards;
        }

        /* Optimized Sparkle particles */
        .sparkle {
            position: fixed;
            width: 5px;
            height: 5px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: sparkleFloat 1s ease-out forwards;
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.8);
            will-change: transform, opacity;
        }

        @keyframes magicParticleFade {
            0% {
                opacity: 1;
                transform: scale(0.8) translate(-50%, -50%);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.2) translate(-50%, -50%);
            }

            100% {
                opacity: 0;
                transform: scale(0.4) translate(-50%, -50%);
            }
        }

        @keyframes magicInnerGlow {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.8);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.6);
            }
        }

        @keyframes sparkleFloat {
            0% {
                opacity: 1;
                transform: scale(0) translateY(0);
            }

            50% {
                opacity: 1;
                transform: scale(1.2) translateY(-15px);
            }

            100% {
                opacity: 0;
                transform: scale(0.3) translateY(-30px);
            }
        }

        /* Rose Petal Rain Effect */
        .petal {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ff6b9d, #ff8fab, #ffb3c1);
            border-radius: 50% 0 50% 50%;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
            animation: fall linear infinite, sway ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
        }

        .petal::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: linear-gradient(45deg, #ff8fab, #ffb3c1);
            border-radius: 50% 0 50% 50%;
            opacity: 0.6;
        }

        .petal::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            width: 12px;
            height: 12px;
            background: linear-gradient(45deg, #ffb3c1, #ffd1dc);
            border-radius: 50% 0 50% 50%;
            opacity: 0.4;
        }

        @keyframes fall {
            0% {
                transform: translateY(-120vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }

            5% {
                opacity: 0.9;
            }

            95% {
                opacity: 0.9;
            }

            100% {
                transform: translateY(120vh) translateX(var(--fall-x, 0px)) rotate(360deg);
                opacity: 0;
            }
        }

        /* Sky gradient for better rain effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg,
                    rgba(255, 247, 230, 0.8) 0%,
                    rgba(255, 214, 165, 0.6) 30%,
                    rgba(255, 181, 167, 0.4) 70%,
                    rgba(255, 181, 167, 0.2) 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* Entrance particles */
        .entrance-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #ff6b9d, #ff8fab);
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
            animation: particleFloat 2s ease-out forwards;
            opacity: 0;
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: scale(0) translateY(0);
            }

            20% {
                opacity: 1;
                transform: scale(1) translateY(-20px);
            }

            80% {
                opacity: 1;
                transform: scale(1) translateY(-60px);
            }

            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-80px);
            }
        }



        .envelope-section {
            perspective: 800px;
            width: 520px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
            position: relative;
            z-index: 10;
            animation: envelopeEntrance 2.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
            opacity: 0;
            transform: scale(0.3) translateY(100px) rotateX(60deg);
        }

        @keyframes envelopeEntrance {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(100px) rotateX(60deg);
                filter: blur(20px);
            }

            20% {
                opacity: 0.8;
                transform: scale(0.8) translateY(-20px) rotateX(20deg);
                filter: blur(10px);
            }

            40% {
                opacity: 1;
                transform: scale(1.1) translateY(10px) rotateX(-5deg);
                filter: blur(5px);
            }

            60% {
                opacity: 1;
                transform: scale(0.95) translateY(-5px) rotateX(2deg);
                filter: blur(2px);
            }

            80% {
                opacity: 1;
                transform: scale(1.02) translateY(2px) rotateX(-1deg);
                filter: blur(0px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0) rotateX(0deg);
                filter: blur(0px);
            }
        }

        .envelope-3d {
            width: 400px;
            height: 280px;
            position: relative;
            transform-style: preserve-3d;
            cursor: grab;
            filter: drop-shadow(0 16px 48px rgba(255, 120, 80, 0.18)) drop-shadow(0 4px 16px #ffb5a7);
            transition: filter 0.3s, box-shadow 0.3s;
            will-change: transform;
            box-shadow: 0 8px 32px 0 rgba(255, 120, 80, 0.10), 0 2px 8px #ffb5a7;
            background: none;
            animation: envelopeGlow 3s ease-out 1s forwards;
        }

        @keyframes envelopeGlow {
            0% {
                filter: drop-shadow(0 16px 48px rgba(255, 120, 80, 0.18)) drop-shadow(0 4px 16px #ffb5a7);
                box-shadow: 0 8px 32px 0 rgba(255, 120, 80, 0.10), 0 2px 8px #ffb5a7;
            }

            50% {
                filter: drop-shadow(0 16px 48px rgba(255, 120, 80, 0.18)) drop-shadow(0 4px 16px #ffb5a7) drop-shadow(0 0 30px rgba(255, 107, 157, 0.6));
                box-shadow: 0 8px 32px 0 rgba(255, 120, 80, 0.10), 0 2px 8px #ffb5a7, 0 0 40px rgba(255, 107, 157, 0.4);
            }

            100% {
                filter: drop-shadow(0 16px 48px rgba(255, 120, 80, 0.18)) drop-shadow(0 4px 16px #ffb5a7);
                box-shadow: 0 8px 32px 0 rgba(255, 120, 80, 0.10), 0 2px 8px #ffb5a7;
            }
        }

        .envelope-3d:active {
            cursor: grabbing;
        }

        .envelope-3d.open {
            filter: drop-shadow(0 32px 64px rgba(255, 120, 80, 0.28)) drop-shadow(0 8px 32px #ffb5a7);
        }

        /* Envelope base (front) */
        .envelope-base {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, #fffbe6 60%, #ffe0b2 100%), repeating-linear-gradient(135deg, #fffbe6 0 2px, #ffe0b2 2px 4px);
            border-radius: 12px 12px 18px 18px;
            z-index: 2;
            overflow: hidden;
            border-bottom: 2px solid #ffe0b2;
            box-shadow: 0 2px 16px 0 #ffe0b2, 0 0 0 1px #fffbe6 inset;
        }

        /* Paper crease/fold effect */
        .envelope-base::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 80%;
            height: 100%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, transparent 45%, #ffe0b2 50%, transparent 55%);
            opacity: 0.18;
            pointer-events: none;
        }

        /* Envelope side flaps */
        .envelope-flap-left,
        .envelope-flap-right {
            position: absolute;
            top: 30px;
            width: 60px;
            height: 120px;
            background: linear-gradient(120deg, #fffbe6 60%, #ffe0b2 100%);
            z-index: 1;
            box-shadow: 0 2px 16px rgba(255, 120, 80, 0.08), 0 0 16px 0 #ffe0b2 inset;
            border-radius: 8px 0 24px 24px/12px 0 32px 32px;
            filter: brightness(0.98) drop-shadow(0 0 8px #ffe0b2);
        }

        .envelope-flap-left {
            left: -36px;
            transform: skewY(18deg) rotateZ(-8deg) rotateY(-30deg);
            background: linear-gradient(120deg, #ffe0b2 0%, #fffbe6 100%);
            box-shadow: 8px 0 24px -8px #ffe0b2 inset, 0 2px 16px rgba(255, 120, 80, 0.08);
        }

        .envelope-flap-right {
            right: -36px;
            transform: skewY(-18deg) rotateZ(8deg) rotateY(30deg);
            background: linear-gradient(120deg, #fffbe6 0%, #ffe0b2 100%);
            box-shadow: -8px 0 24px -8px #ffe0b2 inset, 0 2px 16px rgba(255, 120, 80, 0.08);
        }

        /* Envelope bottom flap */
        .envelope-flap-bottom {
            position: absolute;
            bottom: -36px;
            left: 50%;
            width: 180px;
            height: 60px;
            background: linear-gradient(120deg, #ffe0b2 60%, #fffbe6 100%);
            border-radius: 0 0 60px 60px/0 0 60px 60px;
            box-shadow: 0 8px 32px rgba(255, 120, 80, 0.10), 0 -8px 32px #ffe0b2 inset;
            transform: translateX(-50%) rotateX(30deg);
            z-index: 0;
            filter: brightness(0.97);
        }

        /* Envelope flap (top) */
        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60%;
            background: linear-gradient(120deg, #fffbe6 60%, #ffe0b2 100%);
            border-radius: 12px 12px 60px 60px/24px 24px 60px 60px;
            box-shadow: 0 2px 16px rgba(255, 120, 80, 0.10), 0 8px 32px #ffe0b2 inset;
            transform-origin: top center;
            z-index: 4;
            transition: transform 0.9s cubic-bezier(.77, 0, .18, 1), box-shadow 0.5s;
            filter: drop-shadow(0 0 16px #fffbe6);
        }

        .envelope-3d.open .envelope-flap {
            transform: rotateX(-120deg);
            box-shadow: 0 32px 64px 0 rgba(255, 120, 80, 0.18);
        }

        /* Envelope shadow for realism */
        .envelope-shadow {
            position: absolute;
            bottom: -18px;
            left: 50%;
            width: 80%;
            height: 32px;
            background: radial-gradient(ellipse at center, rgba(60, 40, 20, 0.28) 0%, transparent 80%);
            transform: translateX(-50%);
            z-index: 0;
            filter: blur(4px);
        }

        /* Envelope glow */
        .envelope-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            box-shadow: 0 0 6px 1px #fffbe6, 0 0 12px 2px #ffd6a5;
            opacity: 0.10;
            pointer-events: none;
            z-index: 5;
            mix-blend-mode: lighten;
        }

        /* Envelope inner shadow for depth */
        .envelope-inner-shadow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px 12px 18px 18px;
            box-shadow: inset 0 8px 32px 0 rgba(255, 120, 80, 0.10), inset 0 2px 8px #ffb5a7;
            z-index: 3;
            pointer-events: none;
        }

        /* Cards */
        .cards-container {
            position: absolute;
            top: 24px;
            left: 0;
            width: 100%;
            height: 180px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            z-index: 10;
            pointer-events: none;
            perspective: 800px;
        }

        .card {
            position: absolute;
            width: 220px;
            height: 140px;
            background: linear-gradient(120deg, #fffbe6 60%, #ffe0b2 100%), repeating-linear-gradient(135deg, #fffbe6 0 2px, #ffe0b2 2px 4px);
            border-radius: 16px;
            border: 1.5px solid #e6cfa7;
            box-shadow: 0 12px 36px 0 rgba(255, 120, 80, 0.18), 0 2px 12px #ffb5a7, 0 0 32px 0 #fffbe6;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: #b85c38;
            opacity: 0;
            pointer-events: none;
            transform: translateY(60px) scale(0.95) rotateX(30deg) rotateZ(-2deg);
            transition: opacity 0.6s cubic-bezier(.77, 0, .18, 1), transform 0.9s cubic-bezier(.77, 0, .18, 1), box-shadow 0.5s;
            cursor: pointer;
            user-select: none;
            filter: drop-shadow(0 0 16px #fffbe6);
            will-change: transform, opacity;
            touch-action: pan-y pan-x;
            background-blend-mode: lighten;
            /* Paper texture overlay */
            background-image: linear-gradient(120deg, #fffbe6 60%, #ffe0b2 100%), repeating-linear-gradient(135deg, #fffbe6 0 2px, #ffe0b2 2px 4px), url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            background-size: cover, cover, 200px 200px;
            box-shadow: 0 8px 32px 0 rgba(255, 120, 80, 0.18), 0 1px 8px #ffb5a7, 0 0 32px 0 #fffbe6;
        }

        .envelope-3d.open .card.active,
        .envelope-3d.open .card.rising {
            opacity: 1;
            pointer-events: auto;
        }

        .card.throw-left {
            opacity: 0;
            transform: translate(-320px, -40px) rotateZ(-32deg) scale(0.95) rotateX(-10deg);
            box-shadow: 0 32px 64px 0 #ffe0b2, 0 8px 32px 0 rgba(255, 120, 80, 0.18);
            transition: opacity 0.5s, transform 0.8s cubic-bezier(.77, 0, .18, 1), box-shadow 0.5s;
        }

        .card.throw-right {
            opacity: 0;
            transform: translate(320px, -40px) rotateZ(32deg) scale(0.95) rotateX(-10deg);
            box-shadow: 0 32px 64px 0 #ffe0b2, 0 8px 32px 0 rgba(255, 120, 80, 0.18);
            transition: opacity 0.5s, transform 0.8s cubic-bezier(.77, 0, .18, 1), box-shadow 0.5s;
        }

        .card.rising {
            opacity: 1;
            transform: translateY(-60px) scale(1) rotateX(0deg) rotateZ(var(--card-tilt, 2deg));
            box-shadow: 0 24px 64px 0 #fffbe6, 0 12px 48px 0 rgba(255, 120, 80, 0.18);
            transition: opacity 0.6s, transform 0.9s cubic-bezier(.77, 0, .18, 1), box-shadow 0.5s;
        }

        .card .card-title {
            font-weight: bold;
            font-size: 1.4rem;
            margin-bottom: 0.5em;
            letter-spacing: 0.04em;
            text-shadow: 0 2px 8px #ffe0b2;
        }

        .card .card-content {
            font-size: 1.1rem;
            opacity: 0.85;
            text-shadow: 0 1px 4px #fffbe6;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .envelope-section {
                width: 98vw;
                height: 80vw;
            }

            .envelope-3d {
                width: 90vw;
                height: 60vw;
            }

            .card {
                width: 60vw;
                height: 36vw;
                font-size: 1rem;
            }
        }

        /* Envelope name label */
        .envelope-label {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 32px;
            text-align: center;
            font-family: 'Dancing Script', 'Segoe Script', 'Brush Script MT', cursive, sans-serif;
            font-size: 1.25rem;
            color: #b89c6d;
            letter-spacing: 0.04em;
            opacity: 0.85;
            z-index: 6;
            pointer-events: none;
            text-shadow: 0 1px 2px #fffbe6, 0 2px 8px #ffe0b2;
            user-select: none;
            animation: labelBounce 3s ease-out 2s forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes labelBounce {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            50% {
                opacity: 0.85;
                transform: translateY(-5px);
            }

            75% {
                opacity: 0.85;
                transform: translateY(2px);
            }

            100% {
                opacity: 0.85;
                transform: translateY(0);
            }
        }

        /* Envelope dark outline */
        .envelope-base,
        .envelope-flap,
        .envelope-flap-left,
        .envelope-flap-right,
        .envelope-flap-bottom {
            box-shadow:
                0 0 0 2px rgba(80, 60, 40, 0.13) inset,
                0 1px 4px 0 rgba(60, 40, 20, 0.10);
        }

        .envelope-side {
            position: absolute;
            background: #ffe0b2;
            opacity: 0.95;
            z-index: 2;
        }

        .envelope-side-top,
        .envelope-side-bottom {
            width: 100%;
            height: 16px;
            /* thickness */
            left: 0;
        }

        .envelope-side-top {
            top: 0;
            transform: rotateX(90deg) translateZ(110px);
            /* half of envelope height */
            transform-origin: top;
        }

        .envelope-side-bottom {
            bottom: 0;
            transform: rotateX(90deg) translateZ(-110px);
            transform-origin: bottom;
        }

        .envelope-side-left,
        .envelope-side-right {
            width: 16px;
            /* thickness */
            height: 100%;
            top: 0;
        }

        .envelope-side-left {
            left: 0;
            transform: rotateY(90deg) translateZ(-160px);
            /* half of envelope width */
            transform-origin: left;
        }

        .envelope-side-right {
            right: 0;
            transform: rotateY(90deg) translateZ(160px);
            transform-origin: right;
        }

        .card::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            box-shadow: inset 0 2px 16px 0 rgba(180, 140, 80, 0.08);
            pointer-events: none;
        }

        /* Card click animation */
        .card.clicking {
            animation: cardClick 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes cardClick {
            0% {
                transform: scale(1) rotate(0deg);
                filter: brightness(1) drop-shadow(0 0 16px #fffbe6);
            }

            50% {
                transform: scale(1.3) rotate(8deg);
                filter: brightness(1.8) drop-shadow(0 0 40px rgba(255, 107, 157, 0.9));
            }

            100% {
                transform: scale(1.2) rotate(5deg);
                filter: brightness(1.5) drop-shadow(0 0 30px rgba(255, 107, 157, 0.8));
            }
        }
    </style>
    <!-- Google Fonts for elegant script -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Video Background -->
    <video class="video-background" autoplay muted loop playsinline>
        <source src="Pastel_Gift_Box_Animation_Ready.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Video overlay for better readability -->
    <div class="video-overlay"></div>

    <div class="envelope-section">
        <div class="envelope-3d" id="envelope3d">
            <div class="envelope-flap"></div>
            <div class="envelope-flap-left"></div>
            <div class="envelope-flap-right"></div>
            <div class="envelope-base"></div>
            <div class="envelope-flap-bottom"></div>
            <div class="envelope-inner-shadow"></div>
            <div class="envelope-shadow"></div>
            <div class="envelope-glow"></div>
            <div class="envelope-label">from packroo</div>
            <div class="cards-container">
                <div class="card" id="card0">
                    <div class="card-title">Welcome</div>
                    <div class="card-content">die with dreams not memories</div>
                </div>
            </div>
            <div class="envelope-side envelope-side-top"></div>
            <div class="envelope-side envelope-side-bottom"></div>
            <div class="envelope-side envelope-side-left"></div>
            <div class="envelope-side envelope-side-right"></div>
        </div>
    </div>
    <script>
        // Rose Petal Rain System
        class RosePetalRain {
            constructor() {
                this.petals = [];
                this.maxPetals = 80; // More petals for rain effect
                this.petalSpawnInterval = 150; // Faster spawn rate like rain
                this.lastSpawnTime = 0;
                this.init();
            }

            init() {
                this.spawnPetal();
                this.animate();
            }

            spawnPetal() {
                if (this.petals.length >= this.maxPetals) {
                    this.removeOldestPetal();
                }

                const petal = document.createElement('div');
                petal.className = 'petal';

                // Create rain-like distribution across the sky
                const startX = Math.random() * (window.innerWidth + 200) - 100; // Wider spawn area
                petal.style.left = startX + 'px';

                // Random fall trajectory (like rain)
                const fallX = (Math.random() - 0.5) * 200; // Horizontal drift
                petal.style.setProperty('--fall-x', fallX + 'px');

                // Faster, more rain-like fall
                const fallDuration = 4 + Math.random() * 3; // 4-7 seconds (faster)

                petal.style.animation = `fall ${fallDuration}s linear infinite`;

                // Smaller, more rain-like petals
                const size = 12 + Math.random() * 8; // 12-20px
                petal.style.width = size + 'px';
                petal.style.height = size + 'px';

                // More natural rotation
                const rotation = Math.random() * 180 - 90; // -90 to 90 degrees
                petal.style.transform = `rotate(${rotation}deg)`;

                // Higher opacity for better visibility
                const opacity = 0.7 + Math.random() * 0.3;
                petal.style.opacity = opacity;

                document.body.appendChild(petal);
                this.petals.push(petal);

                // Remove petal after animation
                setTimeout(() => {
                    if (petal.parentNode) {
                        petal.parentNode.removeChild(petal);
                        this.petals = this.petals.filter(p => p !== petal);
                    }
                }, fallDuration * 1000);
            }

            removeOldestPetal() {
                if (this.petals.length > 0) {
                    const oldestPetal = this.petals.shift();
                    if (oldestPetal.parentNode) {
                        oldestPetal.parentNode.removeChild(oldestPetal);
                    }
                }
            }

            animate() {
                const currentTime = Date.now();
                if (currentTime - this.lastSpawnTime > this.petalSpawnInterval) {
                    this.spawnPetal();
                    this.lastSpawnTime = currentTime;
                }

                requestAnimationFrame(() => this.animate());
            }
        }

        // Initialize rose petal rain
        const rosePetalRain = new RosePetalRain();

        // Entrance animation enhancement
        function createEntranceParticles() {
            const envelopeSection = document.querySelector('.envelope-section');
            const rect = envelopeSection.getBoundingClientRect();

            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'entrance-particle';

                    // Random position around envelope
                    const angle = (Math.PI * 2 * i) / 15;
                    const radius = 100 + Math.random() * 50;
                    const x = rect.left + rect.width / 2 + Math.cos(angle) * radius;
                    const y = rect.top + rect.height / 2 + Math.sin(angle) * radius;

                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';

                    document.body.appendChild(particle);

                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        // Trigger entrance particles after envelope appears
        setTimeout(createEntranceParticles, 1500);

        // Optimized Magic Cursor Trail System
        class MagicCursorTrail {
            constructor() {
                this.particles = [];
                this.sparkles = [];
                this.maxParticles = 15;
                this.maxSparkles = 10;
                this.lastMouseX = 0;
                this.lastMouseY = 0;
                this.lastParticleTime = 0;
                this.particleInterval = 50; // ms between particles
                this.init();
            }

            init() {
                document.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                document.addEventListener('touchmove', (e) => this.handleTouchMove(e));
            }

            handleMouseMove(e) {
                const now = Date.now();
                if (now - this.lastParticleTime > this.particleInterval) {
                    this.createMagicParticle(e.clientX, e.clientY);
                    this.createSparkles(e.clientX, e.clientY);
                    this.lastParticleTime = now;
                }
                this.lastMouseX = e.clientX;
                this.lastMouseY = e.clientY;
            }

            handleTouchMove(e) {
                if (e.touches.length > 0) {
                    const touch = e.touches[0];
                    const now = Date.now();
                    if (now - this.lastParticleTime > this.particleInterval) {
                        this.createMagicParticle(touch.clientX, touch.clientY);
                        this.createSparkles(touch.clientX, touch.clientY);
                        this.lastParticleTime = now;
                    }
                    this.lastMouseX = touch.clientX;
                    this.lastMouseY = touch.clientY;
                }
            }

            createMagicParticle(x, y) {
                if (this.particles.length >= this.maxParticles) {
                    this.removeOldestParticle();
                }

                const particle = document.createElement('div');
                particle.className = 'cursor-particle';

                // Reduced randomness for better performance
                const offsetX = (Math.random() - 0.5) * 12;
                const offsetY = (Math.random() - 0.5) * 12;

                particle.style.left = (x + offsetX) + 'px';
                particle.style.top = (y + offsetY) + 'px';

                // Larger size variation for better visibility
                const size = 10 + Math.random() * 8; // 10-18px
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';

                // Shorter animation duration
                const duration = 1 + Math.random() * 0.5; // 1-1.5s
                particle.style.animationDuration = duration + 's';

                document.body.appendChild(particle);
                this.particles.push(particle);

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                        this.particles = this.particles.filter(p => p !== particle);
                    }
                }, duration * 1000);
            }

            createSparkles(x, y) {
                if (this.sparkles.length >= this.maxSparkles) {
                    this.removeOldestSparkle();
                }

                // Create fewer sparkles
                for (let i = 0; i < 2; i++) {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';

                    const angle = (Math.PI * 2 * i) / 2;
                    const radius = 10 + Math.random() * 15;
                    const sparkleX = x + Math.cos(angle) * radius;
                    const sparkleY = y + Math.sin(angle) * radius;

                    sparkle.style.left = sparkleX + 'px';
                    sparkle.style.top = sparkleY + 'px';

                    // Larger sparkle size for better visibility
                    const sparkleSize = 4 + Math.random() * 3; // 4-7px
                    sparkle.style.width = sparkleSize + 'px';
                    sparkle.style.height = sparkleSize + 'px';

                    document.body.appendChild(sparkle);
                    this.sparkles.push(sparkle);

                    setTimeout(() => {
                        if (sparkle.parentNode) {
                            sparkle.parentNode.removeChild(sparkle);
                            this.sparkles = this.sparkles.filter(s => s !== sparkle);
                        }
                    }, 1000);
                }
            }

            removeOldestParticle() {
                if (this.particles.length > 0) {
                    const oldestParticle = this.particles.shift();
                    if (oldestParticle.parentNode) {
                        oldestParticle.parentNode.removeChild(oldestParticle);
                    }
                }
            }

            removeOldestSparkle() {
                if (this.sparkles.length > 0) {
                    const oldestSparkle = this.sparkles.shift();
                    if (oldestSparkle.parentNode) {
                        oldestSparkle.parentNode.removeChild(oldestSparkle);
                    }
                }
            }
        }

        // Initialize Harry Potter magic cursor trail
        const magicCursorTrail = new MagicCursorTrail();

        const envelope = document.getElementById('envelope3d');
        const cards = [
            document.getElementById('card0')
        ];
        let isOpen = false;
        let currentCard = 0;
        let isTransitioning = false;

        // 3D rotation state
        let rotationY = 0;
        let rotationX = 0;
        let lastX = 0;
        let lastY = 0;
        let dragging = false;
        let autoRotate = true;
        let autoRotateId = null;
        let resumeTimeout = null;

        function setEnvelopeRotation(x, y) {
            envelope.style.transform = `rotateX(${x}deg) rotateY(${y}deg)`;
        }

        function animateAutoRotate() {
            if (!autoRotate) return;
            rotationY += 0.2;
            setEnvelopeRotation(rotationX, rotationY);
            autoRotateId = requestAnimationFrame(animateAutoRotate);
        }

        function pauseAutoRotate() {
            autoRotate = false;
            if (autoRotateId) cancelAnimationFrame(autoRotateId);
            if (resumeTimeout) clearTimeout(resumeTimeout);
            resumeTimeout = setTimeout(() => {
                autoRotate = true;
                animateAutoRotate();
            }, 2000);
        }

        // Mouse drag
        envelope.addEventListener('mousedown', (e) => {
            dragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
            pauseAutoRotate();
        });
        document.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            const dx = e.clientX - lastX;
            const dy = e.clientY - lastY;
            rotationY += dx * 0.6;
            rotationX -= dy * 0.4;
            rotationX = Math.max(-60, Math.min(60, rotationX));
            setEnvelopeRotation(rotationX, rotationY);
            lastX = e.clientX;
            lastY = e.clientY;
        });
        document.addEventListener('mouseup', () => {
            dragging = false;
        });
        // Touch drag
        envelope.addEventListener('touchstart', (e) => {
            if (e.touches.length !== 1) return;
            dragging = true;
            lastX = e.touches[0].clientX;
            lastY = e.touches[0].clientY;
            pauseAutoRotate();
        });
        document.addEventListener('touchmove', (e) => {
            if (!dragging || e.touches.length !== 1) return;
            const dx = e.touches[0].clientX - lastX;
            const dy = e.touches[0].clientY - lastY;
            rotationY += dx * 0.6;
            rotationX -= dy * 0.4;
            rotationX = Math.max(-60, Math.min(60, rotationX));
            setEnvelopeRotation(rotationX, rotationY);
            lastX = e.touches[0].clientX;
            lastY = e.touches[0].clientY;
        });
        document.addEventListener('touchend', () => {
            dragging = false;
        });

        // Show the card when envelope is open
        function showCard() {
            cards.forEach((card) => {
                card.classList.remove('active', 'throw-left', 'throw-right', 'rising');
                card.style.setProperty('--card-tilt', (Math.random() * 4 - 2) + 'deg');
                if (envelope.classList.contains('open')) {
                    card.classList.add('rising');
                    setTimeout(() => card.classList.add('active'), 10);
                }
            });
        }
        showCard();

        // Envelope click: open/close
        envelope.addEventListener('click', (e) => {
            if (!isOpen) {
                isOpen = true;
                envelope.classList.add('open');
                document.querySelector('.cards-container').style.pointerEvents = 'auto';
                showCard();
            } else {
                if (e.target.classList.contains('card')) return;
                isOpen = false;
                envelope.classList.remove('open');
                document.querySelector('.cards-container').style.pointerEvents = 'none';
                // Hide card when closing
                cards.forEach(card => card.classList.remove('active', 'throw-left', 'throw-right', 'rising'));
            }
        });

        // Card interaction (click or swipe)
        cards.forEach((card, i) => {
            // Click interaction
            card.addEventListener('click', (e) => {
                if (!isOpen || isTransitioning) return;
                isTransitioning = true;

                // Beautiful transition effect
                card.classList.add('clicking');

                setTimeout(() => {
                    // Open PPT folder
                    window.open('./ppt/index.html', '_blank');

                    // Reset card after transition
                    setTimeout(() => {
                        card.classList.remove('clicking');
                        isTransitioning = false;
                    }, 300);
                }, 600);

                e.stopPropagation();
            });

            // Touch interaction
            let startX = null, startY = null;
            card.addEventListener('touchstart', (e) => {
                if (!isOpen || isTransitioning) return;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });
            card.addEventListener('touchmove', (e) => {
                if (!isOpen || isTransitioning || startX === null) return;
                const dx = e.touches[0].clientX - startX;
                const dy = e.touches[0].clientY - startY;
                if (Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)) {
                    isTransitioning = true;

                    // Beautiful transition effect for touch
                    card.classList.add('clicking');

                    setTimeout(() => {
                        // Open PPT folder
                        window.open('./ppt/index.html', '_blank');

                        // Reset card after transition
                        setTimeout(() => {
                            card.classList.remove('clicking');
                            isTransitioning = false;
                        }, 300);
                    }, 600);

                    startX = null;
                }
            });
            card.addEventListener('touchend', () => { startX = null; startY = null; });
        });
        // Prevent accidental drag
        document.addEventListener('dragstart', e => e.preventDefault());

        // Start auto-rotation
        setEnvelopeRotation(rotationX, rotationY);
        animateAutoRotate();
    </script>
</body>

</html>
